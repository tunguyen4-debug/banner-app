{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ntq.L-AI-TUNV4/ai-banner-app/src/lib/aiClient.ts"],"sourcesContent":["import OpenAI from \"openai\";\n\n// Initialize OpenAI client (will use env vars)\nconst openai = process.env.OPENAI_API_KEY\n  ? new OpenAI({\n      apiKey: process.env.OPENAI_API_KEY,\n    })\n  : null;\n\n// Check if API key is configured\nif (!process.env.OPENAI_API_KEY) {\n  console.warn(\n    \"⚠️  OPENAI_API_KEY not found in environment variables. AI features will use mock data.\"\n  );\n}\n\nexport interface AnalyzeResult {\n  companyName: string;\n  companyDescription: string;\n  mainServices: string[];\n  summary: string;\n  tone: string;\n  audience: string;\n  conceptSuggestions: Array<{\n    headline: string;\n    subheadline: string;\n    cta: string;\n    styleGuide: {\n      colors: string[];\n      font: string;\n      mood: string;\n    };\n  }>;\n  recommendedPrompt: string;\n}\n\nexport interface GenerateDesignResult {\n  imageUrl?: string;\n  htmlLayout?: string;\n  css?: string;\n  promptUsed: string;\n  thinkingSteps: Array<{\n    step: string;\n    timestamp: number;\n    content?: string;\n    code?: string;\n  }>;\n}\n\n/**\n * Analyze website content and generate banner concepts\n */\nexport async function analyzeWebsite(\n  content: string\n): Promise<AnalyzeResult> {\n  const prompt = `You are an expert marketing strategist and brand analyst. Carefully analyze this company website content in detail. Extract ALL key information including company name, what they do, their main services/products, and brand identity.\n\nWebsite content (read EVERY section carefully - company info, hero, about, sections by H2, paragraphs, key phrases, navigation, list items):\n${content.substring(0, 16000)}\n\nYour task - extract in DETAIL:\n1. COMPANY NAME: From title, OG title, logo alt, or main H1. Be exact.\n2. WHAT THE COMPANY DOES: From meta description, hero/intro, about section, and first paragraphs. Write 2-3 clear sentences covering industry, main business, and key value proposition.\n3. MAIN SERVICES/PRODUCTS: From navigation, list items, and section headings. List 4-6 specific offerings (not generic \"Services\").\n4. SUMMARY: A rich 4-6 sentence overview: who they are, what they do, who they serve, key differentiators or numbers (e.g. \"500+ engineers\"), and tone. Use concrete details from the content.\n5. TONE & AUDIENCE: Infer from wording and sections. Be specific (e.g. \"B2B enterprises in Asia\" not just \"businesses\").\n6. BANNER CONCEPTS: Headlines must include company name; subheadlines must reflect real services/value from the content.\n\nProvide a JSON response with:\n- companyName: Exact company name\n- companyDescription: 2-3 sentences (what they do, for whom, key strength)\n- mainServices: Array of 4-6 specific services/products from the site\n- summary: Detailed 4-6 sentence brand overview (use numbers, key phrases, differentiators from content)\n- tone: Brand voice (one or two words)\n- audience: Specific target (e.g. \"B2B enterprises\", \"SMB in Vietnam\")\n- conceptSuggestions: Array of 2-3 concepts with headline (company name + value), subheadline (specific services/value), cta, styleGuide (colors, font, mood)\n- recommendedPrompt: Detailed banner prompt with company name, real services, and style\n\nReturn ONLY valid JSON, no markdown formatting.`;\n\n  // Mock mode if no API key: parse content in detail for rich analysis\n  if (!openai) {\n    console.log(\"Using mock analysis (no API key) - extracting from website content\");\n    const companyNameMatch = content.match(/Company Name \\(from title\\):\\s*(.+?)(?:\\n|$)/i)\n      || content.match(/Page Title:\\s*(.+?)(?:\\s*[-|]\\s|$)/i)\n      || content.match(/OG Title:\\s*(.+?)(?:\\n|$)/i);\n    const companyName = companyNameMatch\n      ? companyNameMatch[1].trim().replace(/\\s*[-|].*$/, \"\").substring(0, 80)\n      : \"Company\";\n\n    const metaDesc = content.match(/Meta Description:\\s*(.+?)(?:\\n\\n|\\n===|$)/is);\n    const ogDesc = content.match(/OG Description:\\s*(.+?)(?:\\n\\n|\\n===|$)/is);\n    const companyDescription = (metaDesc?.[1]?.trim() || ogDesc?.[1]?.trim() || \"\").substring(0, 220)\n      || \"Professional services and solutions for your business.\";\n\n    const h1Match = content.match(/H1:\\s*(.+?)(?:\\n\\n|\\n===|$)/i);\n    const h1Text = h1Match ? h1Match[1].trim().split(\"|\").map((s: string) => s.trim()).filter(Boolean)[0] : \"\";\n\n    const heroMatch = content.match(/HERO \\/ INTRO TEXT ===\\s*\\n([\\s\\S]+?)(?:\\n\\n===|$)/i);\n    const heroText = heroMatch ? heroMatch[1].trim().substring(0, 300) : \"\";\n\n    const sectionsMatch = content.match(/CONTENT BY SECTIONS \\(H2\\) ===\\s*\\n([\\s\\S]+?)(?:\\n\\n===|$)/i);\n    const sectionsText = sectionsMatch ? sectionsMatch[1].trim().substring(0, 600) : \"\";\n\n    const navMatch = content.match(/NAVIGATION \\/ MENU \\/ SERVICES ===\\s*\\n([\\s\\S]+?)(?:\\n\\n===|$)/i);\n    const navStr = navMatch ? navMatch[1].trim() : \"\";\n    const mainServices = navStr\n      ? navStr.split(\"|\").map((s: string) => s.trim()).filter(s => s.length > 2 && s.length < 45).slice(0, 6)\n      : [];\n\n    const listMatch = content.match(/LIST ITEMS \\/ FEATURES ===\\s*\\n-?\\s*([\\s\\S]+?)(?:\\n\\n===|$)/i);\n    const listStr = listMatch ? listMatch[1].trim() : \"\";\n    const listItems = listStr.split(/\\n-/).map((s: string) => s.trim()).filter(s => s.length > 5 && s.length < 80).slice(0, 8);\n    if (listItems.length && mainServices.length < 3) mainServices.push(...listItems.slice(0, 4));\n    const services = mainServices.length ? mainServices.slice(0, 6) : (h1Text ? [h1Text] : [\"Services\", \"Solutions\", \"Consulting\"]);\n\n    const paragraphsMatch = content.match(/ALL PARAGRAPHS \\(main body\\) ===\\s*\\n([\\s\\S]+?)(?:\\n\\n===|$)/i);\n    const paraText = paragraphsMatch ? paragraphsMatch[1].trim().substring(0, 500) : \"\";\n    const summaryParts = [companyName, companyDescription, heroText || paraText, sectionsText].filter(Boolean);\n    const summary = summaryParts.join(\" \").substring(0, 520) + (summaryParts.join(\" \").length > 520 ? \"…\" : \"\");\n\n    return {\n      companyName: companyName || \"Company\",\n      companyDescription: companyDescription || \"Professional solutions\",\n      mainServices: services,\n      summary: summary || \"Company information extracted from website.\",\n      tone: \"professional\",\n      audience: \"Businesses and clients seeking quality services\",\n      conceptSuggestions: [\n        {\n          headline: `${companyName} — ${h1Text || \"Solutions\"}`,\n          subheadline: (companyDescription + (heroText ? \" \" + heroText.substring(0, 80) : \"\")).substring(0, 120),\n          cta: \"Contact Us\",\n          styleGuide: {\n            colors: [\"#1e3a5f\", \"#2563eb\", \"#0ea5e9\"],\n            font: \"Inter\",\n            mood: \"modern, confident, professional\",\n          },\n        },\n        {\n          headline: `${companyName}`,\n          subheadline: (h1Text || companyDescription).substring(0, 120),\n          cta: \"Learn More\",\n          styleGuide: {\n            colors: [\"#0f766e\", \"#0d9488\", \"#14b8a6\"],\n            font: \"Inter\",\n            mood: \"trustworthy, innovative\",\n          },\n        },\n      ],\n      recommendedPrompt: `Professional marketing banner for ${companyName}. Display company name prominently. Include: ${companyDescription.substring(0, 100)}. Services: ${services.slice(0, 4).join(\", \")}. Modern, clean design.`,\n    };\n  }\n\n  try {\n    const completion = await openai.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages: [\n        {\n          role: \"system\",\n          content:\n            \"You are a marketing strategist. Return only valid JSON, no markdown or code blocks.\",\n        },\n        { role: \"user\", content: prompt },\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.7,\n    });\n\n    const result = JSON.parse(\n      completion.choices[0]?.message?.content || \"{}\"\n    ) as AnalyzeResult;\n\n    return result;\n  } catch (error) {\n    console.error(\"AI analysis error:\", error);\n    // Return fallback data\n    return {\n      summary: \"Brand analysis completed. Ready to generate banners.\",\n      tone: \"professional\",\n      audience: \"General audience\",\n      conceptSuggestions: [\n        {\n          headline: \"Transform Your Business\",\n          subheadline: \"Discover innovative solutions\",\n          cta: \"Get Started\",\n          styleGuide: {\n            colors: [\"#6366f1\", \"#8b5cf6\", \"#06b6d4\"],\n            font: \"Inter\",\n            mood: \"modern, confident\",\n          },\n        },\n      ],\n      recommendedPrompt:\n        \"Modern marketing banner with gradient background, professional typography, clean layout\",\n    };\n  }\n}\n\n/**\n * Generate banner image using AI\n */\nexport async function generateBannerImage(\n  prompt: string\n): Promise<{ imageUrl: string }> {\n  // Mock mode if no API key\n  if (!openai) {\n    console.log(\"Using mock image (no API key)\");\n    // Return a placeholder image URL\n    return {\n      imageUrl:\n        \"https://via.placeholder.com/1200x400/6366f1/ffffff?text=Mock+Banner+Preview%0A(Add+OPENAI_API_KEY+to+generate+real+images)\",\n    };\n  }\n\n  try {\n    console.log(\"Generating image with prompt:\", prompt);\n    const response = await openai.images.generate({\n      model: \"dall-e-3\",\n      prompt: `Marketing banner design: ${prompt}. Professional, high-quality, suitable for web advertising.`,\n      size: \"1024x1792\", // Portrait banner\n      quality: \"standard\",\n      n: 1,\n    });\n\n    console.log(\"DALL-E response:\", response);\n    const imageUrl = response.data[0]?.url || \"\";\n    console.log(\"Generated image URL:\", imageUrl);\n    \n    if (!imageUrl) {\n      throw new Error(\"No image URL returned from DALL-E\");\n    }\n    \n    return { imageUrl };\n  } catch (error) {\n    console.error(\"Image generation error:\", error);\n    if (error instanceof Error) {\n      throw new Error(`Failed to generate image: ${error.message}`);\n    }\n    throw new Error(\"Failed to generate image\");\n  }\n}\n\n/**\n * Parse color hints from user prompt (e.g. \"vàng đen\", \"yellow black\", \"đỏ\")\n */\nfunction parseColorsFromPrompt(prompt: string): string[] | null {\n  const p = prompt.toLowerCase();\n  const colorMap: Record<string, string[]> = {\n    \"vàng đen\": [\"#1a1a1a\", \"#2d2d2d\", \"#FACC15\"],\n    \"yellow black\": [\"#1a1a1a\", \"#2d2d2d\", \"#FACC15\"],\n    \"vàng và đen\": [\"#1a1a1a\", \"#FACC15\"],\n    \"đen vàng\": [\"#1a1a1a\", \"#262626\", \"#FACC15\"],\n    \"black yellow\": [\"#1a1a1a\", \"#262626\", \"#FACC15\"],\n    \"đỏ\": [\"#dc2626\", \"#b91c1c\", \"#f87171\"],\n    \"red\": [\"#dc2626\", \"#b91c1c\", \"#f87171\"],\n    \"xanh dương\": [\"#2563eb\", \"#1d4ed8\", \"#3b82f6\"],\n    \"blue\": [\"#2563eb\", \"#1d4ed8\", \"#3b82f6\"],\n    \"xanh lá\": [\"#16a34a\", \"#15803d\", \"#22c55e\"],\n    \"green\": [\"#16a34a\", \"#15803d\", \"#22c55e\"],\n    \"tím\": [\"#7c3aed\", \"#6d28d9\", \"#8b5cf6\"],\n    \"purple\": [\"#7c3aed\", \"#6d28d9\", \"#8b5cf6\"],\n    \"cam\": [\"#ea580c\", \"#c2410c\", \"#f97316\"],\n    \"orange\": [\"#ea580c\", \"#c2410c\", \"#f97316\"],\n  };\n  for (const [key, colors] of Object.entries(colorMap)) {\n    if (p.includes(key)) return colors;\n  }\n  if (/\\b(vàng|yellow)\\b/.test(p) && /\\b(đen|black)\\b/.test(p)) return [\"#1a1a1a\", \"#2d2d2d\", \"#FACC15\"];\n  return null;\n}\n\n/**\n * Generate HTML/CSS layout for banner\n */\nexport async function generateHtmlLayout(\n  prompt: string,\n  concept?: AnalyzeResult[\"conceptSuggestions\"][0],\n  companyInfo?: { companyName?: string; companyDescription?: string; mainServices?: string[] },\n  userModification?: string\n): Promise<{ html: string; css: string }> {\n  // Mock mode if no API key\n  if (!openai) {\n    console.log(\"Using mock HTML/CSS (no API key)\");\n    const companyName = companyInfo?.companyName || concept?.headline.split(/[-—]/)[0]?.trim() || \"Company Name\";\n    const headline = concept?.headline?.replace(companyName + \" - \", \"\")?.replace(companyName + \" — \", \"\")?.replace(companyName + \" \", \"\") || \"Solutions & Services\";\n    const subheadline = concept?.subheadline || companyInfo?.companyDescription || \"Discover innovative solutions for your business.\";\n    const servicesList = companyInfo?.mainServices?.slice(0, 4) || [];\n    const cta = concept?.cta || \"Get Started\";\n    // Apply user's color/modification from prompt (e.g. \"vàng đen\", \"yellow black\")\n    const promptColors = parseColorsFromPrompt(prompt);\n    const colors = promptColors || concept?.styleGuide.colors || [\"#1e3a5f\", \"#2563eb\", \"#0ea5e9\"];\n    const servicesHtml = servicesList.length\n      ? `<ul class=\"banner-services-list\">${servicesList.map((s: string) => `<li><span class=\"banner-service-pill\">${s}</span></li>`).join(\"\")}</ul>`\n      : \"\";\n\n    return {\n      html: `\n        <div class=\"banner\">\n          <div class=\"banner-bg-pattern\"></div>\n          <div class=\"banner-inner\">\n            <div class=\"banner-main\">\n              <div class=\"banner-badge\">Professional</div>\n              <h1 class=\"banner-company-name\">${companyName}</h1>\n              <p class=\"banner-tagline\">${headline}</p>\n              <p class=\"banner-description\">${subheadline}</p>\n              ${servicesHtml}\n              <div class=\"banner-cta-wrap\">\n                <button class=\"banner-cta primary\">${cta}</button>\n                <span class=\"banner-cta-secondary\">Learn more</span>\n              </div>\n            </div>\n            <div class=\"banner-side\">\n              <div class=\"banner-card\">\n                <div class=\"banner-card-value\">Trusted</div>\n                <div class=\"banner-card-label\">Partner</div>\n              </div>\n              <div class=\"banner-card\">\n                <div class=\"banner-card-value\">Quality</div>\n                <div class=\"banner-card-label\">Focus</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      `,\n      css: `\n        .banner {\n          width: 1200px;\n          min-height: 480px;\n          background: linear-gradient(135deg, ${colors[0]} 0%, ${colors[1] || colors[0]} 50%, ${colors[2] || colors[1] || colors[0]} 100%);\n          border-radius: 16px;\n          box-shadow: 0 25px 80px rgba(0,0,0,0.25), 0 0 0 1px rgba(255,255,255,0.08);\n          position: relative;\n          overflow: hidden;\n          font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;\n        }\n        .banner-bg-pattern {\n          position: absolute;\n          inset: 0;\n          background: radial-gradient(ellipse 80% 50% at 100% 50%, rgba(255,255,255,0.12) 0%, transparent 50%),\n                      linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.06) 100%);\n          pointer-events: none;\n        }\n        .banner-inner {\n          position: relative;\n          z-index: 1;\n          display: flex;\n          align-items: stretch;\n          justify-content: space-between;\n          padding: 48px 56px;\n          min-height: 480px;\n        }\n        .banner-main {\n          flex: 1;\n          max-width: 720px;\n          color: #fff;\n        }\n        .banner-badge {\n          display: inline-block;\n          font-size: 11px;\n          font-weight: 600;\n          letter-spacing: 0.12em;\n          text-transform: uppercase;\n          color: rgba(255,255,255,0.9);\n          background: rgba(255,255,255,0.18);\n          padding: 6px 14px;\n          border-radius: 100px;\n          margin-bottom: 20px;\n        }\n        .banner-company-name {\n          font-size: 42px;\n          font-weight: 700;\n          letter-spacing: -0.02em;\n          line-height: 1.15;\n          margin: 0 0 12px 0;\n          text-shadow: 0 2px 20px rgba(0,0,0,0.2);\n        }\n        .banner-tagline {\n          font-size: 22px;\n          font-weight: 600;\n          opacity: 0.95;\n          margin: 0 0 16px 0;\n          line-height: 1.35;\n        }\n        .banner-description {\n          font-size: 16px;\n          line-height: 1.6;\n          opacity: 0.9;\n          margin: 0 0 28px 0;\n          max-width: 540px;\n        }\n        .banner-services-list {\n          list-style: none;\n          margin: 0 0 32px 0;\n          padding: 0;\n          display: flex;\n          flex-wrap: wrap;\n          gap: 10px;\n        }\n        .banner-services-list li { margin: 0; padding: 0; }\n        .banner-service-pill {\n          display: inline-block;\n          font-size: 13px;\n          font-weight: 500;\n          color: rgba(255,255,255,0.95);\n          background: rgba(255,255,255,0.2);\n          padding: 8px 16px;\n          border-radius: 8px;\n          border: 1px solid rgba(255,255,255,0.25);\n        }\n        .banner-cta-wrap {\n          display: flex;\n          align-items: center;\n          gap: 20px;\n        }\n        .banner-cta {\n          border: none;\n          padding: 16px 32px;\n          font-size: 16px;\n          font-weight: 600;\n          border-radius: 10px;\n          cursor: pointer;\n          transition: transform 0.15s, box-shadow 0.2s;\n        }\n        .banner-cta.primary {\n          background: #fff;\n          color: ${colors[0]};\n          box-shadow: 0 4px 20px rgba(0,0,0,0.2);\n        }\n        .banner-cta.primary:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 8px 28px rgba(0,0,0,0.25);\n        }\n        .banner-cta-secondary {\n          font-size: 14px;\n          font-weight: 500;\n          color: rgba(255,255,255,0.9);\n          text-decoration: underline;\n          text-underline-offset: 3px;\n          cursor: pointer;\n        }\n        .banner-side {\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          gap: 16px;\n          margin-left: 40px;\n        }\n        .banner-card {\n          background: rgba(255,255,255,0.15);\n          backdrop-filter: blur(8px);\n          border: 1px solid rgba(255,255,255,0.25);\n          border-radius: 12px;\n          padding: 20px 28px;\n          min-width: 140px;\n          text-align: center;\n        }\n        .banner-card-value {\n          font-size: 20px;\n          font-weight: 700;\n          color: #fff;\n          margin-bottom: 4px;\n        }\n        .banner-card-label {\n          font-size: 12px;\n          font-weight: 500;\n          color: rgba(255,255,255,0.85);\n          text-transform: uppercase;\n          letter-spacing: 0.05em;\n        }\n      `,\n    };\n  }\n\n  const companyInfoText = companyInfo \n    ? `\\nCompany Name: ${companyInfo.companyName}\\nCompany Description: ${companyInfo.companyDescription}\\nMain Services: ${companyInfo.mainServices?.join(\", \")}`\n    : \"\";\n\n  const userRequestBlock = userModification && userModification.length > 0\n    ? `\\n\\n*** CRITICAL - USER MODIFICATION REQUEST (you MUST apply this): ***\\n\"${userModification}\"\\n*** Apply the above changes (colors, style, layout) to the banner. Then follow the requirements below. ***\\n\\n`\n    : \"\";\n\n  const layoutPrompt = `${userRequestBlock}You are an expert web designer. Create a RICH, PROFESSIONAL marketing banner (HTML + CSS) that looks like a high-end SaaS/corporate landing hero.\n\nREQUIRED ELEMENTS (include all):\n1. COMPANY NAME - large, bold (e.g. 38-44px), prominent at top\n2. SHORT TAGLINE or HEADLINE - under company name (e.g. 20-24px)\n3. DESCRIPTION - 1-2 sentences explaining what the company does (e.g. 15-17px, max-width for readability)\n4. SERVICES / KEY OFFERINGS - display as 3-5 pills or badges (e.g. \"Software Development\", \"Consulting\") in a row\n5. PRIMARY CTA BUTTON - main action (e.g. \"Contact Us\", \"Get Started\")\n6. OPTIONAL: small badge at top (e.g. \"Professional\" or \"Trusted Partner\") and/or 1-2 small value cards (e.g. \"Trusted Partner\", \"Quality Focus\") on the right side\n\nDesign requirements:\n- Size: 1200px width, min-height 480px (not 400px)\n- Layout: main content left (company name, tagline, description, services, CTA); optional cards or accent on right\n- Use gradient background with the provided colors; subtle overlay or pattern is fine\n- Professional typography: clear hierarchy, good line-height, text-shadow if needed for readability\n- Pills/badges for services: rounded, semi-transparent background, readable\n- One primary CTA button (white or contrasting), optional secondary text link\n- Rounded corners (12-16px), subtle shadow. No simple one-line layout.\n\nConcept details:\nPrompt: ${prompt}\n${concept ? `Headline: ${concept.headline}\\nSubheadline: ${concept.subheadline}\\nCTA: ${concept.cta}\\nColors: ${concept.styleGuide.colors.join(\", \")}\\nMood: ${concept.styleGuide.mood}` : \"\"}\n${companyInfoText}\n\nReturn a JSON object with:\n- html: Complete HTML (semantic: divs with classes like banner, banner-company-name, banner-tagline, banner-description, banner-services-list or banner-service-pill, banner-cta, etc.)\n- css: Full CSS for all classes (gradient, spacing, typography, pills, button, cards). Banner must be 1200px wide, min-height 480px.\n\nThe banner must look professional and information-rich: anyone should immediately see company name, what they do, and key services.\nReturn ONLY valid JSON, no markdown formatting.`;\n\n  try {\n    const completion = await openai.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages: [\n        {\n          role: \"system\",\n          content:\n            \"You are a frontend developer. Return only valid JSON with 'html' and 'css' keys.\",\n        },\n        { role: \"user\", content: layoutPrompt },\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.8,\n    });\n\n    const result = JSON.parse(\n      completion.choices[0]?.message?.content || \"{}\"\n    ) as { html: string; css: string };\n\n    return {\n      html: result.html || \"<div>Banner HTML</div>\",\n      css: result.css || \"div { padding: 20px; }\",\n    };\n  } catch (error) {\n    console.error(\"HTML generation error:\", error);\n    return {\n      html: '<div class=\"banner\"><h1>Banner</h1></div>',\n      css: \".banner { padding: 20px; }\",\n    };\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 750, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ntq.L-AI-TUNV4/ai-banner-app/src/app/api/analyze-url/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport * as cheerio from \"cheerio\";\nimport { analyzeWebsite } from \"@/lib/aiClient\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { url } = await request.json();\n\n    if (!url || typeof url !== \"string\") {\n      return NextResponse.json(\n        { error: \"URL is required\" },\n        { status: 400 }\n      );\n    }\n\n    // Normalize URL: ensure it has a protocol\n    let urlToFetch = url.trim();\n    if (!/^https?:\\/\\//i.test(urlToFetch)) {\n      urlToFetch = \"https://\" + urlToFetch;\n    }\n\n    // Validate URL format\n    let parsedUrl: URL;\n    try {\n      parsedUrl = new URL(urlToFetch);\n    } catch {\n      return NextResponse.json(\n        { error: \"Invalid URL format. Please use a full URL (e.g. https://example.com)\" },\n        { status: 400 }\n      );\n    }\n\n    // Only allow http and https\n    if (![\"http:\", \"https:\"].includes(parsedUrl.protocol)) {\n      return NextResponse.json(\n        { error: \"Only HTTP and HTTPS URLs are supported\" },\n        { status: 400 }\n      );\n    }\n\n    // Fetch website content (try https first, then http if needed)\n    let html: string | undefined;\n    const urlsToTry = [parsedUrl.href];\n    if (parsedUrl.protocol === \"https:\") {\n      urlsToTry.push(parsedUrl.href.replace(/^https:\\/\\//i, \"http://\"));\n    }\n\n    let lastError: Error | null = null;\n\n    for (const fetchUrl of urlsToTry) {\n      try {\n        console.log(\"Fetching URL:\", fetchUrl);\n\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), 20000);\n\n        const response = await fetch(fetchUrl, {\n          method: \"GET\",\n          headers: {\n            \"User-Agent\":\n              \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",\n            Accept:\n              \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n            \"Accept-Language\": \"en-US,en;q=0.9,vi;q=0.8\",\n            \"Cache-Control\": \"no-cache\",\n            \"Upgrade-Insecure-Requests\": \"1\",\n          },\n          signal: controller.signal,\n          redirect: \"follow\",\n          // @ts-expect-error Next.js extends fetch with cache\n          cache: \"no-store\",\n        });\n\n        clearTimeout(timeoutId);\n\n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}`);\n        }\n\n        const contentType = response.headers.get(\"content-type\") || \"\";\n        if (\n          !contentType.includes(\"text/html\") &&\n          !contentType.includes(\"text/plain\")\n        ) {\n          console.warn(\"Content-Type is not HTML:\", contentType);\n        }\n\n        html = await response.text();\n\n        if (!html || html.length < 100) {\n          throw new Error(\"Website returned empty or very short content\");\n        }\n\n        console.log(`Fetched ${html.length} characters of HTML`);\n        lastError = null;\n        break;\n      } catch (error) {\n        lastError = error as Error;\n        console.warn(\"Fetch attempt failed for\", fetchUrl, lastError.message);\n        if (urlsToTry.indexOf(fetchUrl) < urlsToTry.length - 1) {\n          continue; // try next URL\n        }\n      }\n    }\n\n    if (lastError != null || html == null) {\n      const err = (lastError || new Error(\"Unknown\")) as Error & {\n        cause?: Error;\n        code?: string;\n      };\n      console.error(\"Fetch error:\", err);\n\n      let userMessage: string;\n\n      if (err.name === \"AbortError\" || err.message?.includes(\"aborted\")) {\n        userMessage =\n          \"Request timeout. The website took too long to respond. Try again or use a different URL.\";\n      } else if (err.message?.includes(\"fetch failed\")) {\n        const cause = err.cause?.message || err.cause?.toString() || \"\";\n        if (\n          cause.includes(\"certificate\") ||\n          cause.includes(\"SSL\") ||\n          cause.includes(\"TLS\")\n        ) {\n          userMessage =\n            \"SSL certificate error. Try entering the URL with http:// instead of https:// for this site.\";\n        } else if (\n          cause.includes(\"ENOTFOUND\") ||\n          cause.includes(\"getaddrinfo\")\n        ) {\n          userMessage =\n            \"Domain not found. Check the URL (e.g. https://example.com) and try again.\";\n        } else if (\n          cause.includes(\"ECONNREFUSED\") ||\n          cause.includes(\"ECONNRESET\")\n        ) {\n          userMessage =\n            \"Connection refused or reset. The site may be down or blocking requests. Try another URL.\";\n        } else {\n          userMessage =\n            \"Could not connect. Check: (1) URL has https:// or http:// (2) Site opens in your browser (3) Try another company website.\";\n        }\n      } else if (\n        err.message?.includes(\"timeout\") ||\n        err.message?.includes(\"HTTP 5\")\n      ) {\n        userMessage =\n          \"Website did not respond in time or returned an error. Try again or another URL.\";\n      } else {\n        userMessage =\n          err.message ||\n          \"Could not fetch website. Check the URL and try again.\";\n      }\n\n      return NextResponse.json(\n        { error: userMessage },\n        { status: 500 }\n      );\n    }\n\n    // Parse HTML and extract comprehensive content (detailed for rich analysis)\n    const $ = cheerio.load(html as string);\n\n    // Basic meta\n    const title = $(\"title\").text().trim();\n    const metaDescription = $('meta[name=\"description\"]').attr(\"content\") || \"\";\n    const metaKeywords = $('meta[name=\"keywords\"]').attr(\"content\") || \"\";\n    const ogTitle = $('meta[property=\"og:title\"]').attr(\"content\") || \"\";\n    const ogDescription = $('meta[property=\"og:description\"]').attr(\"content\") || \"\";\n\n    const logoAlt = $(\"img[alt*='logo'], img[alt*='Logo'], .logo img\").attr(\"alt\") || \"\";\n    const companyNameFromTitle = title.split(\" - \")[0].split(\" | \")[0].trim();\n\n    const headings = {\n      h1: $(\"h1\").map((_, el) => $(el).text().trim()).get().slice(0, 8),\n      h2: $(\"h2\").map((_, el) => $(el).text().trim()).get().slice(0, 15),\n      h3: $(\"h3\").map((_, el) => $(el).text().trim()).get().slice(0, 15),\n    };\n\n    // More paragraphs and longer text (hero, intro, about sections)\n    const allParagraphs = $(\"p\")\n      .map((_, el) => $(el).text().trim())\n      .get()\n      .filter(p => p.length > 15)\n      .slice(0, 35);\n    const heroIntro = $(\".hero p, .intro p, .banner p, [class*='hero'] p, [class*='intro'] p\").map((_, el) => $(el).text().trim()).get().filter(Boolean).slice(0, 5);\n    const aboutSection = $(\"[class*='about'] p, #about p\").map((_, el) => $(el).text().trim()).get().filter(p => p.length > 20).slice(0, 5);\n\n    // Sections by H2: for each H2, take the following text until next H2\n    const sectionsByH2: string[] = [];\n    $(\"h2\").slice(0, 12).each((_, h2El) => {\n      const h2Text = $(h2El).text().trim();\n      const next = $(h2El).nextUntil(\"h2\").map((_, el) => $(el).text().trim()).get().join(\" \").trim();\n      if (h2Text && next.length > 30) sectionsByH2.push(`[${h2Text}]: ${next.substring(0, 400)}`);\n    });\n\n    const navItems = $(\"nav a, .menu a, .navigation a, header a\")\n      .map((_, el) => $(el).text().trim())\n      .get()\n      .filter(item => item.length > 1 && item.length < 60)\n      .slice(0, 25);\n\n    const listItems = $(\"li\")\n      .map((_, el) => $(el).text().trim())\n      .get()\n      .filter(item => item.length > 8 && item.length < 250)\n      .slice(0, 30);\n\n    const buttons = $(\"button, .btn, .button, a[class*='button'], a[class*='btn']\")\n      .map((_, el) => $(el).text().trim())\n      .get()\n      .filter(btn => btn.length > 0 && btn.length < 50)\n      .slice(0, 12);\n\n    // Strong/bold phrases (often key value props)\n    const strongPhrases = $(\"strong, b\").map((_, el) => $(el).text().trim()).get().filter(s => s.length > 3 && s.length < 100).slice(0, 15);\n\n    const content = [\n      `=== COMPANY & PAGE INFO ===`,\n      `Company Name (from title): ${companyNameFromTitle}`,\n      `Logo Alt: ${logoAlt}`,\n      `Page Title: ${title}`,\n      `Meta Description: ${metaDescription}`,\n      `Meta Keywords: ${metaKeywords}`,\n      `OG Title: ${ogTitle}`,\n      `OG Description: ${ogDescription}`,\n      ``,\n      `=== HEADINGS STRUCTURE ===`,\n      `H1: ${headings.h1.join(\" | \")}`,\n      `H2: ${headings.h2.join(\" | \")}`,\n      `H3: ${headings.h3.join(\" | \")}`,\n      ``,\n      `=== HERO / INTRO TEXT ===`,\n      heroIntro.join(\"\\n\\n\"),\n      ``,\n      `=== ABOUT SECTION ===`,\n      aboutSection.join(\"\\n\\n\"),\n      ``,\n      `=== CONTENT BY SECTIONS (H2) ===`,\n      sectionsByH2.join(\"\\n\\n\"),\n      ``,\n      `=== ALL PARAGRAPHS (main body) ===`,\n      allParagraphs.join(\"\\n\\n\"),\n      ``,\n      `=== KEY PHRASES (bold/strong) ===`,\n      strongPhrases.join(\" | \"),\n      ``,\n      `=== NAVIGATION / MENU / SERVICES ===`,\n      navItems.join(\" | \"),\n      ``,\n      `=== LIST ITEMS / FEATURES ===`,\n      listItems.join(\"\\n- \"),\n      ``,\n      `=== BUTTONS / CTAs ===`,\n      buttons.join(\" | \"),\n    ]\n      .filter(Boolean)\n      .join(\"\\n\\n\");\n\n    if (!content.trim() || content.length < 50) {\n      console.error(\"Extracted content too short:\", content.substring(0, 200));\n      return NextResponse.json(\n        { error: \"Could not extract meaningful content from the website. The page might be empty, require JavaScript to load content, or be blocked.\" },\n        { status: 500 }\n      );\n    }\n\n    console.log(`Extracted ${content.length} characters of content`);\n    console.log(\"Content preview:\", content.substring(0, 500));\n\n    // Analyze with AI\n    let analysis;\n    try {\n      analysis = await analyzeWebsite(content);\n      console.log(\"Analysis completed:\", {\n        companyName: analysis.companyName,\n        hasConcepts: analysis.conceptSuggestions?.length > 0,\n      });\n    } catch (error) {\n      console.error(\"AI analysis error:\", error);\n      return NextResponse.json(\n        { error: `AI analysis failed: ${error instanceof Error ? error.message : \"Unknown error\"}` },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({\n      url: parsedUrl.toString(),\n      analysis,\n    });\n  } catch (error) {\n    console.error(\"Analyze URL error:\", error);\n    const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\n    return NextResponse.json(\n      { error: `Internal server error: ${errorMessage}` },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}